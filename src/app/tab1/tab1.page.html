<!-- HTML corregido - tab1.page.html -->
<ion-content class="home-bg" [fullscreen]="true">
  <!-- Banner superior simplificado -->
  <div class="app-banner">
    <div class="search-section">
      <div class="search-row">
        <ion-searchbar 
          class="search-bar" 
          placeholder="Busca regalos, chocolates, flores..." 
          show-clear-button="focus"
          mode="ios"
          animated="true"
          (ionInput)="onSearchChange($event)"
          [(ngModel)]="searchText">
        </ion-searchbar>
        <button class="profile-btn" (click)="openProfileMenu($event)">
          <ion-icon name="person-circle" class="profile-icon"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Resultados de b√∫squeda (categor√≠as y productos) -->
  <div class="search-results-container" *ngIf="showResults && searchResults.length > 0">
    <div class="search-results-list">
      <div class="search-result-item"
           *ngFor="let result of searchResults"
           (click)="onSelectResult(result)"
           [ngClass]="result.type === 'category' ? 'result-category' : 'result-product'">
        <div class="result-icon-wrapper" [ngClass]="{'category-icon': result.type === 'category', 'product-icon': result.type === 'product'}">
          <ion-icon *ngIf="result.type === 'category'" [name]="result.icon" class="result-icon"></ion-icon>
          <span *ngIf="result.type === 'product'" class="product-icon-text">üéÅ</span>
        </div>
        <div class="result-info">
          <h4 class="result-name">{{ result.name }}</h4>
          <span class="result-description">
            {{ result.type === 'category' ? 'Categor√≠a' : 'Producto' }} ‚Ä¢ {{ result.description }}
          </span>
        </div>
        <ion-icon name="chevron-forward" class="result-arrow"></ion-icon>
      </div>
    </div>
  </div>

  <!-- Promoci√≥n destacada -->
  <div class="promo-banner" *ngIf="showPromo && (!showResults || searchResults.length === 0)">
    <div class="promo-content">
      <ion-icon name="gift" class="promo-icon"></ion-icon>
      <div class="promo-text">
        <span class="promo-title">¬°Primer regalo!</span>
        <span class="promo-subtitle">20% OFF en tu primer pedido</span>
      </div>
    </div>
    <ion-button fill="clear" size="small" class="promo-close" (click)="showPromo = false">
      <ion-icon name="close"></ion-icon>
    </ion-button>
  </div>

  <!-- Pedido en camino -->
  <ng-container *ngIf="currentOrder$ | async as currentOrder">
    <div class="current-order-container" *ngIf="!currentOrder.isDelivered" (click)="goToOrderConfirmation()">
      <div class="order-content">
        <div class="order-header">
          <ion-icon name="cube" class="order-icon"></ion-icon>
          <div class="order-text">
            <p class="order-label">Pedido en camino</p>
            <p class="order-number">{{ currentOrder.orderNumber }}</p>
          </div>
        </div>
        <div class="order-details">
          <div class="detail-item">
            <span class="detail-label">Tiempo estimado</span>
            <span class="detail-value">{{ currentOrder.timeRemaining || currentOrder.estimatedTime }} seg</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Total</span>
            <span class="detail-value">${{ currentOrder.total.toFixed(2) }}</span>
          </div>
        </div>
      </div>
      <ion-icon name="chevron-forward" class="order-arrow"></ion-icon>
    </div>
  </ng-container>

  <!-- Categor√≠as con t√≠tulo simplificado -->
  <div class="section-header" *ngIf="!showResults && searchText === ''">
    <h2 class="section-title">Categor√≠as</h2>
  </div>

  <!-- Grid de categor√≠as mejorado (sin experiencias) -->
  <div class="categories-grid" *ngIf="!showResults && searchText === ''">
    <ion-card class="category-card" *ngFor="let cat of categories" (click)="onCategory(cat.id)">
      <div class="card-overlay"></div>
      <ion-img [src]="getCategoryImage(cat.id)" [alt]="cat.name" class="category-bg" loading="lazy"></ion-img>
      <ion-card-content class="category-content">
        <div class="category-icon-wrapper">
          <ion-icon [name]="cat.icon" class="category-icon"></ion-icon>
        </div>
        <span class="category-title">{{ cat.name }}</span>
        <span class="category-count">{{ cat.count }} opciones</span>
      </ion-card-content>
      <div class="category-badge" *ngIf="cat.popular">
        <ion-badge color="success">Popular</ion-badge>
      </div>
    </ion-card>
  </div>

  <!-- Mensaje cuando no hay resultados -->
  <div *ngIf="searchText && searchResults.length === 0 && !showResults" class="no-results">
    <ion-icon name="search" class="no-results-icon"></ion-icon>
    <h2>No encontramos "{{ searchText }}"</h2>
    <p>Intenta con otro t√©rmino o explora nuestras categor√≠as</p>
  </div>

  <!-- Secci√≥n de ofertas -->
  <div class="section-header" *ngIf="!showResults">
    <h2 class="section-title">Ofertas especiales</h2>
  </div>
  
  <div class="offers-slider" *ngIf="!showResults">
    <ion-card class="offer-card">
      <div class="offer-content">
        <div class="offer-text">
          <h3>Env√≠o gratis</h3>
          <p>En pedidos superiores a $25.000</p>
        </div>
        <ion-icon name="rocket" class="offer-icon"></ion-icon>
      </div>
    </ion-card>
    
    <ion-card class="offer-card">
      <div class="offer-content">
        <div class="offer-text">
          <h3>Pack San Valent√≠n</h3>
          <p>Flores + chocolates -15%</p>
        </div>
        <ion-icon name="heart" class="offer-icon"></ion-icon>
      </div>
    </ion-card>
  </div>
</ion-content>